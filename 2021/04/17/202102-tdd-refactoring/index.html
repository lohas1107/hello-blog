<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>202102 演化式設計：測試驅動開發與持續重構 -- 心得 | 第二大腦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="上完演化式設計：測試驅動開發與持續重構，課後兩個月補記心得和筆記。">
<meta property="og:type" content="article">
<meta property="og:title" content="202102 演化式設計：測試驅動開發與持續重構 -- 心得">
<meta property="og:url" content="https://2ndbrain.cc/2021/04/17/202102-tdd-refactoring/index.html">
<meta property="og:site_name" content="第二大腦">
<meta property="og:description" content="上完演化式設計：測試驅動開發與持續重構，課後兩個月補記心得和筆記。">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2021-04-17T06:12:25.000Z">
<meta property="article:modified_time" content="2024-09-16T01:02:53.943Z">
<meta property="article:author" content="Irene Wang">
<meta property="article:tag" content="日誌">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/images/logo.svg">
  
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&family=Tourney&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
  />
  
<link rel="stylesheet" href="/css/all.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header
    class="py-md-4 border-bottom border-primary-200"
    style="margin-bottom: 1px;"
  >
  <nav class="navbar navbar-expand-md py-md-1">
    <div class="container">
      <a class="navbar-brand py-0" href="/">
        <img src="/images/logo.svg" alt="logo">
      </a>
      <button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
        <span class="material-symbols-outlined fs-1 text-primary-900">menu</span>
      </button>
      <div class="collapse navbar-collapse offset-md-2 offset-lg-3" id="navbarToggler">
        <ul class="navbar-nav me-auto mb-2 mb-md-0 text-center">
          
          
            <li class="nav-item mb-4 mb-md-0 me-md-3 me-lg-7">
              <a
                class="nav-link "
                href="/"
              >
                <span class="position-relative px-2 py-1">首頁</span>
              </a>
            </li>
          
            <li class="nav-item ">
              <a
                class="nav-link "
                href="/blog"
              >
                <span class="position-relative px-2 py-1">部落格</span>
              </a>
            </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>


  <main>
  <section class="container pb-7 pt-lg-9 pb-lg-7 mt-lg-9">
    <div class="row flex-lg-row-reverse justify-content-lg-between pb-md-7">
      <div class="col-12 col-lg-3">
        <aside class="blog__menu px-3 py-4 p-lg-7 bg-primary-100">
  <ul class="d-flex flex-lg-column justify-content-md-center justify-content-lg-start gap-7 mb-0 p-xxl-7 list-unstyled">
    <li class="flex-shrink-0">
      
      <a href="/blog" class=" pb-1 fs-5 text-primary-600 link-primary-500 bg-transparent text-decoration-none" type="button">全部文章</a>
    </li>
    
      
      <li class="flex-shrink-0">
        <a href="/tags/%E6%97%A5%E8%AA%8C/" class=" pb-1 fs-5 text-primary-600 link-primary-500 bg-transparent text-decoration-none">
          日誌
        </a>
      </li>
    
      
      <li class="flex-shrink-0">
        <a href="/tags/%E6%8A%80%E8%A1%93/" class=" pb-1 fs-5 text-primary-600 link-primary-500 bg-transparent text-decoration-none">
          技術
        </a>
      </li>
    
  </ul>
</aside>
      </div>
      <article class="article-container col-12 col-lg-8 mt-9 mt-lg-0 mb-0 pt-9 pt-lg-0 text-primary-700" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
        <nav class="mb-3 mb-lg-7" aria-label="breadcrumb">
          <ol class="breadcrumb">
            
              <li class="breadcrumb-item text-primary-500">
                <a class="text-primary-500 text-decoration-none" href="/tags/%E6%97%A5%E8%AA%8C/" rel="tag">日誌</a>

              </li>
            
            <li class="breadcrumb-item text-primary-500 active" aria-current="page">2021/04/17 發佈</li>
          </ol>
        </nav>
        <h1 class="mb-3 mb-lg-4 fs-2 text-center">202102 演化式設計：測試驅動開發與持續重構 -- 心得</h1>
        
        <p>上完<a target="_blank" rel="noopener" href="https://dotblogs.com.tw/hatelove/2020/08/21/202102-Evolutionary-Development-TDD-and-Continuous-Refactoring">演化式設計：測試驅動開發與持續重構</a>，課後兩個月補記心得和筆記。</p>
<span id="more"></span>

<h2 id="專業有價"><a href="#專業有價" class="headerlink" title="專業有價"></a>專業有價</h2><p>早在 2018 左右就聽說 <a target="_blank" rel="noopener" href="https://tdd.best/">91 的課</a>，當時看到上課時間居然在半年後，而且一堂課要價超過一萬元，就一直處於觀望狀態而沒有報名課程。幸好在這期間我看了《刻意練習》後，就一直心心念念想找到利用「<strong>刻意練習</strong>」模式教學的課程，再加上我開始認同「專業有價」，花錢就能買到別人累積的功力，超級划算。於是，在剩下最後幾個名額時，趕緊手刀報名，心裡想不管發生什麼事，都不能妨礙我去上課，要是再不做出行動，現在這門課是開課前一年就額滿 ⋯⋯</p>
<h2 id="從了解需求開始"><a href="#從了解需求開始" class="headerlink" title="從了解需求開始"></a>從了解需求開始</h2><ul>
<li>由實作的人去問出需求</li>
<li>用具體的例子談需求，甚至用錯誤的例子誘導對方講出正確的需求</li>
</ul>
<p>說到討論需求，近日有新的感想，我終於可以察覺出「問出需求」和「擬定做法」是兩回事。</p>
<p>以前很多時候，我只是在覆核 PM 提出的調整可不可行，而沒有去探究背後的需求，現在可以練習再多問『想做出調整的原因？』和問『什麼會想用這個方式調整？』，這樣才能有足夠的資訊選擇最適當的做法。另外，我發現我很習慣用簡短或沒整理過的描述和其他人討論事情，用具體的例子和其他人溝通是我還需要多練習的課題。</p>
<h2 id="便利貼起手式"><a href="#便利貼起手式" class="headerlink" title="便利貼起手式"></a>便利貼起手式</h2><ul>
<li>拆解會需要的程式碼片段，可使用便利貼或 Mind Map 工具</li>
<li>和團隊成員一起決定命名或 API 規格</li>
</ul>
<p>以前我都會一邊設計程式一邊敲鍵盤，因為覺得與其花時間在腦袋一直空想，還不如直接就開始寫程式，邊理解需求邊寫程式還邊重構，自以為我真是會敏捷開發，但是常常發生 A 設計寫到一半覺得不夠好，應該要改成 B 設計，B 設計寫到一半發現有情境沒考慮到，所以一開始才會寫成 A 設計那樣，改過來又改回去，搞到最後沒時間好好梳理程式架構和流程。</p>
<p>所以二月週末上完課，週一進辦公室，我就乖乖到文具櫃去拿一本便利貼來用，仔細拆解會需要的程式碼片段，再開始敲程式碼，寫程式有明顯變得比較順，思路也比較周全，反而花比較少時間開發，對於 Task 的完成度更有信心。</p>
<h2 id="安排測試案例，小步重構"><a href="#安排測試案例，小步重構" class="headerlink" title="安排測試案例，小步重構"></a>安排測試案例，小步重構</h2><ul>
<li>測試案例必須是使用情境，命名要描述 Domain，不能出現具體的例子名稱</li>
<li>測試案例從最簡單的案例開始寫，如果要改太多就拆小一點<blockquote>
<p>最簡單的意思是：加最少的程式碼片段，或複製測試案例改最少的程式碼片段。</p>
</blockquote>
</li>
<li>TDD 只需要列出可以把需要的程式碼片段開發完成即可，不用列出所有案例</li>
</ul>
<p>我之前以為用排列組合列出所有測試案例，就是最系統化的方式，完全沒想過測試案例的順序是要刻意安排的，所以一次不會改動太多程式，比較沒有除錯壓力，搭配便利貼起手式一起服用更有效。先做好全局的思考，這時候再開始用 TDD 的方式寫程式：</p>
<ol>
<li>Baby Step：一次做少一點，然後該做的有做完（一個完整的使用情境）</li>
<li>紅燈 → 綠燈：無腦通過測試案例</li>
<li>綠燈 → 重構：從刻意產生重複的程式碼演進成 Production Code 設計</li>
</ol>
<h2 id="重構-Legacy-Code"><a href="#重構-Legacy-Code" class="headerlink" title="重構 Legacy Code"></a>重構 Legacy Code</h2><p>Legacy Code 是實務上最常會遇到的情況，通常 Legacy Code 沒有單元測試保護，所以就沒人敢改。<br>利用單元測試和強大的 <a target="_blank" rel="noopener" href="https://www.jetbrains.com/">IDE 工具</a>自動產生程式碼做重構，安全地跳脫惡性循環：</p>
<ol>
<li>整理代碼：刪除 comment、調整爛命名、多餘空白行、Temp Variables</li>
<li>整理流程：消除重複、凸顯意圖<blockquote>
<p>不要太早抽方法，會不容易看出重複，可用 Inline Method 回復 Method。</p>
</blockquote>
</li>
<li>改邏輯要有對應的測試保護</li>
<li>分職責<ul>
<li>物件導向（高內聚）：用物件模型模擬真實世界，把資料往物件堆，叫物件做事</li>
<li>Design Pattern（低耦合）</li>
</ul>
</li>
</ol>
<p>原則上設計心法就是用最簡單的方式滿足使用者情境，並且寫最少的防呆，參數越少越好用。</p>
<blockquote>
<p>Keep it Simple, don’t overdesign your solution.</p>
</blockquote>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>[演化式設計：測試驅動開發與持續重構] 是 [針對遺留代碼加入單元測試的藝術] 和 [極速開發] 兩門課的集大成，上完課後仍需要不斷練習和反思，才能持續進步。原本課前預習就應該要先了解 <a target="_blank" rel="noopener" href="https://refactoring.guru/refactoring/smells">Code Smell</a> 和 <a target="_blank" rel="noopener" href="https://refactoring.guru/refactoring/techniques">Refactoring</a> 相關知識，但在上課前我沒有確實做到，現在要補下基本功，也藉此督促自己要熟練課堂上的重構練習。</p>


        
      </article>
    </div>
  </section>

  <section class="container px-6 px-lg-0 pt-7 pb-7 pb-lg-9 mt-lg-7 mb-7 mb-lg-9 border-top border-primary-400">
    <h3 class="mb-7 text-center text-lg-start text-primary-700">相關文章</h3>
    <div class="row row-gap-5">
      
        
          
        
      
    </div>

  </section>
</main>

  <footer
    class="py-7"
    style="background-image: url('/images/footer-bg-lg.png');
      background-repeat: no-repeat;
      background-size: cover;"
  >
  <div class="container">
    <div class="row row-gap-7 justify-content-between align-items-center my-md-7">
      <div class="col-12 col-md-4 col-lg-3">
        <img
          class="mb-4"
          style="width: 120px;"
          src="/images/logo.svg" alt="logo"
        >
      </div>
    </div>
  </div>
</footer>
  
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  
<script src="/js/swiper.js"></script>

</body>
</html>